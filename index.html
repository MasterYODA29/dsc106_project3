<!DOCTYPE html>
<html lang="en">
<head>  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 3 Visualization</title>
    <link href="style.css" rel="stylesheet" >
     <script src="data.js"></script>
    <script src="global.js" type="module"></script>  
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!--if need legend:-->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script> -->
</head>
<body> 
    <!--Random Comment:-->
    <h1>The Impact of Age, Weight, and Height on Anesthesia Depth During Surgery</h1>

    <h2>Relationship between Bispectral Index (BIS) and time during an operation where the BIS measures the depth of anesthesia. Shows how anesthesia levels change over the duration of a surgery depending on age, weight, and height.</h2>

    <div class="container">
        <div class="slider-container">
            <label for="ageSlider">Age:</label>
            <input type="range" id="age" min="20" max="79" step="1" value="20">
            <span id="ageValue">20</span>

            <label for="weightSlider">Weight (kg):</label>
            <input type="range" id="weight" min="45" max="89" step="1" value="45">
            <span id="weightValue">45</span>

            <label for="heightSlider">Height (cm):</label>
            <input type="range" id="height" min="150" max="179" step="1" value="150">
            <span id="heightValue">150</span>
        </div>
    
        <div id="line-chart"></div>
        <div id="legend"></div>
    </div>
    
    <div id="tooltip" class="tooltip" style="opacity: 0;"></div>
    <h3>The Rationale and Process</h3>
    <p>
        We chose a line plot of the patient/case BIS data over the timespan of the surgery cases. We allowed for a flexible slider that allowed for personal customization and adjustments for different BMI combinations, as well as a tooltip to allow the user to hover and see the exact values each point corresponded to.
    </p>

    <h3>Data Wrangling and Implementation</h3>
    
    <p>
        The process first involved Iman working on some exploratory data analysis and data wrangling regarding the anesthesia dataset. After extracting the data from the API provided on the website, the tracks dataset was pulled, which allows for the pulling of the BIS data by key. Once that was loaded in, different categories were formed across constant weight, age, and height increments, with the data taking on aggregated values within these bins to discretize the BIS graph, and allowing for more representative visualizations. Finally, the binned BIS Data are stored in a nested JSON file, and the data processing steps are complete.
    </p>
    
    <p>
        Using the data uploaded and extracted from the API that Imangeldi preprocessed, I decided to try to apply a gradient on random custom images of human silhouettes for different body types. I applied a custom cool-warm gradient while applying a radial map to calculate the distance of each point within the image as an array, and then used Matplotlib's FuncAnimation to create an animation of how this gradient would evolve (for 1 case) based on the BIS values. I scrapped the idea because timewise it would have been more difficult to include on D3.
    </p>

    <p>
        Leah uploaded and created some containers for the actual graphic/visualization by using the output vis_final function from the notebook to obtain the actual JSON data for the BIS data, and transferred the data over to the data.js file containing the nested JSON data according to BMI indices, and then used D3 to create SVG circle elements and line paths for each data point, creating the axes, as well as parsing the data to convert the string data type in the JSON file into numeric data that D3 can plot.
    </p>

    <p>
        Edgar added transition style selection rules to make the transition as the slider was dragged for the BIS plot to look smoother by varying the transition time and other stylization rules for the container of the slider and graph. He also implemented a tooltip for hovering over each circle graphic, which would enlarge the dot and turn it orange, as well as display the exact time proportion and BIS value, as well as an average dotted line for the entire BIS values.
    </p>

    <h3>Project Workflow</h3>
    <p>
        We had one large meeting with all members present to discuss our dataset and visualization approach. After narrowing down to two options, we chose the Anesthesia data because it provided a strong mix of interesting patterns and a feasible implementation within our timeline. I followed up with Imangeldi to discuss variables to track, binning and categorization strategies, and how the dataset would be structured.
    </p>

    <p>
        Later Imangeldi, Leah, and Edgar had a virtual meeting  to go over data integration in D3, setting up the containers, sliders, and tooltips. After finalizing the visualizations, we reviewed the live website and made final adjustments before completing this writeup.
    </p>

    <p><strong>Time Contributions:</strong> Each group member contributed approximately 8-10+ hours to the project.</p>

    <h3>Visual Encoding and Illustrative Design</h3>
    <p>
        From the start, we wanted the user to interact personally with the visualization in an engaging and informative way. We followed medical visualization conventions by allowing patient-centric biometrics to be entered through sliders. Initially, I proposed a gradient-based visualization across different body types, but we decided a line plot of BIS data would be clearer.
    </p>

    <p>
        To improve readability, we discretized the continuous BIS waveform into binned time segments, preventing visual clutter. A red dashed line representing the average BIS value was included to serve as a reference point, helping users interpret anesthesia depth changes across different BMI categories.
    </p>

    <p>
        The transitions were fine-tuned to be smooth yet fast enough to allow comparison between BMI indices, preventing sudden disruptions. We also dynamically adjusted the axis scale so that users wouldn't have to shift their focus drastically when toggling between data sets.
    </p>
    </body>  
</html> 
